<Project>

  <Target Name="BuildSiteExtension">

    <GetDotNetHost>
      <Output TaskParameter="DotNetDirectory" PropertyName="DotnetHomeDirectory" />
    </GetDotNetHost>

    <PropertyGroup>
      <FallbackArchive>$(COHERENCE_SIGNED_DROP_LOCATION)\fallbackArchives\nuGetPackagesArchive-$(TimestampVersion).zip</FallbackArchive>
      <RuntimeStore>$(COHERENCE_SIGNED_DROP_LOCATION)\Signed\PackageCache\aspnetcore-store-$(TimestampVersion)-win7-x86.zip</RuntimeStore>
    </PropertyGroup>

    <PropertyGroup>
      <FallbackArchiveDestination>$(TempDir)FallbackArchive</FallbackArchiveDestination>
      <RuntimeStoreDestination>$(TempDir)RuntimeStore</RuntimeStoreDestination>
    </PropertyGroup>

    <UnzipArchive File="$(FallbackArchive)" Destination="$(FallbackArchiveDestination)" Overwrite="true" />
    <UnzipArchive File="$(RuntimeStore)" Destination="$(RuntimeStoreDestination)" Overwrite="true" />

    <MSBuild Projects="$(RepositoryRoot)src\Microsoft.AspNetCore.SiteExtension\Microsoft.AspNetCore.SiteExtension.csproj"
      Targets="Pack"
      Properties="DotnetHomeDirectory=$(DotnetHomeDirectory);FallbackArchiveDestination=$(FallbackArchiveDestination);RuntimeStoreDestination=$(RuntimeStoreDestination)" />
  </Target>

</Project>